First Ping all machines:

ping master.metis.com
ping node1.metis.com
ping node2.metis.com

On worker node:
yum install -y krb5-workstation pam_krb5

On master node:

yum install -y krb5-server krb5-workstation pam_krb5

cd  /var/kerberos/krb5kdc

ls

vi kadm5.acl
 //enter into acl file  and change domain name with your own

vi kdc.conf

//change EXAMPLE.COM to METIS.COM

cd /etc

vi krb5.conf

cd -

Create the KDC Database

When creating the KDC database we will need an entropy pool of random data. Please check that your rngd service is running correctly as it does not by default in CentOS 7 or 7.1. you can read my post on setting this up here. You will be prompted to set a secure password to the database key when you run the following command.

kdb5_util create -s -r METIS.COM


Loading random data
Initializing database '/var/kerberos/krb5kdc/principal' for realm 'METIS.COM',
master key name 'K/M@METIS.COM'
You will be prompted for the database Master Password.
It is important that you NOT FORGET this password.
Enter KDC database master key:metis123
Re-enter KDC database master key to verify:metis123


Start and Enable Kerberos
We are now ready to start and enable the two services:

systemctl start krb5kdc kadmin
systemctl enable krb5kdc kadmin
systemctl status krb5kdc kadmin

listprincs

K/M@METIS.COM
kadmin/admin@METIS.COM
kadmin/changepw@METIS.COM
kadmin/master.metis.com@METIS.COM
kiprop/master.metis.com@METIS.COM
krbtgt/METIS.COM@METIS.COM

addprinc root/admin

WARNING: no policy specified for root/admin@METIS.COM; defaulting to no policy
Enter password for principal "root/admin@METIS.COM":
Re-enter password for principal "root/admin@METIS.COM":
Principal "root/admin@METIS.COM" created.

kadmin.local:  listprincs
K/M@METIS.COM
kadmin/admin@METIS.COM
kadmin/changepw@METIS.COM
kadmin/master.metis.com@METIS.COM
kiprop/master.metis.com@METIS.COM
krbtgt/METIS.COM@METIS.COM
root/admin@METIS.COM

kadmin.local:  addprinc tux
WARNING: no policy specified for tux@METIS.COM; defaulting to no policy
Enter password for principal "tux@METIS.COM":
Re-enter password for principal "tux@METIS.COM":
Principal "tux@METIS.COM" created.


kadmin.local:  addprinc -randkey host/master.metis.com
WARNING: no policy specified for host/master.metis.com@METIS.COM; defaulting to no policy
Principal "host/master.metis.com@METIS.COM" created.


kadmin.local:  ktadd host/master.metis.com
Entry for principal host/master.metis.com with kvno 2, encryption type aes256-cts-hmac-sha1-96 added to keytab FILE:/etc/krb5.keytab.
Entry for principal host/master.metis.com with kvno 2, encryption type aes128-cts-hmac-sha1-96 added to keytab FILE:/etc/krb5.keytab.
Entry for principal host/master.metis.com with kvno 2, encryption type des3-cbc-sha1 added to keytab FILE:/etc/krb5.keytab.
Entry for principal host/master.metis.com with kvno 2, encryption type arcfour-hmac added to keytab FILE:/etc/krb5.keytab.
Entry for principal host/master.metis.com with kvno 2, encryption type camellia256-cts-cmac added to keytab FILE:/etc/krb5.keytab.
Entry for principal host/master.metis.com with kvno 2, encryption type camellia128-cts-cmac added to keytab FILE:/etc/krb5.keytab.
Entry for principal host/master.metis.com with kvno 2, encryption type des-hmac-sha1 added to keytab FILE:/etc/krb5.keytab.
Entry for principal host/master.metis.com with kvno 2, encryption type des-cbc-md5 added to keytab FILE:/etc/krb5.keytab.

Configure SSH Client
On the Kerberos client server we need to edit the SSH Client file to allow all clients by default to use Kerberos authentication. To do this edit the file /etc/ssh/ssh_config and add the lines:
vi /etc/ssh/ssh_config

GSSAPIAuthentication yes
GSSAPIDelegateCredentials yes

Allow Kerberos Authentication to the Server

From the command line we can allow Kerberos authentication either using authconfig-tui or simply with the command:

authconfig  --enablekrb5 --update

This will make the changes tot he PAM configuration. I would also reload SSH at this stage to be certain everything is in place:

# systemctl reload sshd

export JAVA_HOME=/usr/lib/jvm/java-9-oracle

sudo wget -nv --no-check-certificate --no-cookies --header "Cookie: oraclelicense=accept-securebackup-cookie" http://download.oracle.com/otn-pub/java/jce/8/UnlimitedJCEPolicyJDK8.zip




